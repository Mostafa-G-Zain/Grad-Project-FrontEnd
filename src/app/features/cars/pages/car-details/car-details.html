@if (!loading()) {
@if (car(); as c) {
<div class="container py-5">
  <div class="row gy-4">
    <!-- Images + car info -->
    <div class="col-lg-7">
      <!-- Main image + carousel controls -->
      <div class="main-image mb-3">
        @if (c.imageUrls?.length) {
        <!-- Previous -->
        <button type="button" class="carousel-control prev" (click)="prevImage()" [disabled]="c.imageUrls.length <= 1">
          <i class="fa-solid fa-chevron-left"></i>
        </button>

        <!-- Stage with CSS animation -->
        <div class="image-stage">
          @for (img of c.imageUrls; track $index; let i = $index) {
          @if (i === selectedImageIndex()) {
          <img [src]="'https://carnest.runasp.net/' + img" class="img-fluid rounded-4 shadow-sm w-100 fade-image"
            alt="Car image" />
          }
          }
        </div>

        <!-- Next -->
        <button type="button" class="carousel-control next" (click)="nextImage()" [disabled]="c.imageUrls.length <= 1">
          <i class="fa-solid fa-chevron-right"></i>
        </button>

        <!-- Indicators -->
        <div class="carousel-indicators">
          @for (img of c.imageUrls; track $index; let i = $index) {
          <button type="button" class="indicator-dot" [class.active]="i === selectedImageIndex()"
            (click)="setImage(i)"></button>
          }
        </div>
        } @else {
        <img src="assets/placeholder.jpg" class="img-fluid rounded-4 shadow-sm w-100" alt="Car image" />
        }
      </div>

      <!-- Thumbnails -->
      @if (c.imageUrls?.length) {
      <div class="d-flex flex-wrap gap-2">
        @for (img of c.imageUrls; track $index; let i = $index) {
        <img [src]="'https://carnest.runasp.net/' + img" class="img-thumbnail thumb-img"
          [class.active-thumb]="i === selectedImageIndex()" (click)="setImage(i)" alt="Car image" />
        }
      </div>
      }

      <!-- Car summary card -->
      <div class="card car-summary-card border-0 mt-3 shadow-sm rounded-4 mb-3">
        <div class="card-body">
          <!-- Title + price + meta -->
          <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
            <div>
              <h3 class="car-title fw-bold mb-1">
                {{ c.makeName }} {{ c.modelName }} {{ c.year }}
              </h3>

              <div class="car-subtitle text-muted small d-flex flex-wrap align-items-center gap-2">
                <span>
                  <i class="fa-solid fa-calendar-days me-1"></i>
                  {{ c.createdDate | date: 'mediumDate' }}
                </span>
                <span class="bullet-separator">•</span>
                <span>
                  <i class="fa-solid fa-location-dot me-1"></i>
                  {{ c.locationName }}
                </span>
              </div>
            </div>

            <div class="text-md-end">
              <div class="car-price text-primary fw-bold mb-1">
                {{ c.price | currency: 'EGP ' }}
              </div>
              <span class="badge bg-light border text-primary small">
                <i class="fa-solid fa-tag me-1"></i> For sale
              </span>
            </div>
          </div>

          <!-- Meta with icons -->
          <div class="d-flex flex-wrap gap-3 car-meta">
            <div class="car-meta-item">
              <i class="fa-solid fa-car-side car-meta-icon"></i>
              <div>
                <div class="car-meta-label">Body</div>
                <div class="car-meta-value">{{ c.bodyTypeName }}</div>
              </div>
            </div>

            <div class="car-meta-item">
              <i class="fa-solid fa-gas-pump car-meta-icon"></i>
              <div>
                <div class="car-meta-label">Fuel</div>
                <div class="car-meta-value">{{ c.fuelName }}</div>
              </div>
            </div>

            <div class="car-meta-item">
              <i class="fa-regular fa-calendar car-meta-icon"></i>
              <div>
                <div class="car-meta-label">Year</div>
                <div class="car-meta-value">{{ c.year }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seller info -->
    <div class="col-lg-5">
      <div class="card border-0 shadow-sm rounded-4 seller-card">
        <div class="card-header bg-white border-0 pb-0">
          <h6 class="fw-bold mb-0 d-flex align-items-center">
            <i class="fa-solid fa-user-tie me-2 text-primary"></i>
            Seller information
          </h6>
        </div>
        <div class="card-body pt-3">
          <!-- Seller main row -->
          <div class="d-flex align-items-center mb-3">
            <div class="seller-icon-circle me-2">
              <i class="fa-solid fa-user"></i>
            </div>
            <div>
              <div class="seller-name fw-semibold">
                {{ c.publisherName }}
              </div>
              <div class="text-muted small">
                Private seller
              </div>
            </div>
          </div>

          <!-- Contact -->
          <ul class="list-unstyled seller-contact mb-3">
            @if (c.publisherPhone) {
            <li>
              <a href="tel:{{ c.publisherPhone }}">
                <i class="fa-solid fa-phone"></i>
                {{ c.publisherPhone }}
              </a>
            </li>
            }

            @if (c.publisherEmail) {
            <li>
              <a [href]="'mailto:' + c.publisherEmail">
                <i class="fa-solid fa-envelope"></i>
                {{ c.publisherEmail }}
              </a>
            </li>
            }

            @if (c.locationName) {
            <li>
              <i class="fa-solid fa-location-dot"></i>
              <span>{{ c.locationName }}</span>
            </li>
            }
          </ul>

          <p class="text-muted small mb-0">
            You can contact the seller using the phone or email above.
          </p>
        </div>
      </div>

      <div class="mt-3">
        <a routerLink="/cars" class="btn btn-outline-secondary btn-sm">
          ← Back to cars list
        </a>
      </div>
    </div>
  </div>

  <!-- Description -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm rounded-4 description-card">
        <div class="card-body">
          <h5 class="fw-bold mb-3">Description</h5>
          <p class="mb-0">
            {{ c.description || 'No description provided.' }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
} @else {
<div class="container py-5">
  @if (error()) {
  <div class="alert alert-danger">
    {{ error() }}
  </div>
  } @else {
  <p class="text-muted">Car not found.</p>
  }
</div>
}
} @else {
<div class="container py-5 text-center">
  <div class="spinner-border text-primary" role="status"></div>
  <p class="mt-2 text-muted">Loading car details...</p>
</div>
}